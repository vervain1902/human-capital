units = "in")
}
# 3 describe raw vals and adjusted vals of avg edu_year ----
# 3.1 change of [national] ----
file_name <- file.path(cog_dir, "8_Macro_Pop0_pCog0_aEduy0.dta")
df_eduy <- import(file_name)
df_eduy$cyear <- as.factor(df_eduy$cyear)
df_eduy <- df_eduy %>%
arrange(cyear)
df_sum <- df_eduy %>%
group_by(cyear) %>%
summarise(
t_pop0 = sum(pop0, na.rm = TRUE),
t_eduy0 = sum(eduy0, na.rm = TRUE),
t_a_eduy0 = sum(a_eduy0, na.rm = TRUE)
) %>%
mutate(
avg_eduy0 = t_eduy0 / t_pop0,
avg_a_eduy0 = t_a_eduy0 / t_pop0,
cyear = as.factor(cyear)
)
df_sum <- df_sum %>%
mutate(fill_color = ifelse(avg_a_eduy0 > avg_eduy0, "lightgray", "darkgray"))
p <- ggplot(df_sum, aes(x = cyear)) +
geom_ribbon(aes(ymin = pmin(avg_eduy0, avg_a_eduy0), ymax = pmax(avg_eduy0, avg_a_eduy0), fill = fill_color), alpha = 0.5) +
geom_line(aes(y = avg_a_eduy0, color = "平均受教育年限调整值", group = 1), size = 1) +
geom_point(aes(y = avg_a_eduy0, color = "平均受教育年限调整值", shape = "平均受教育年限调整值"), size = 4) +
geom_line(aes(y = avg_eduy0, color = "平均受教育年限", group = 2), size = 1) +
geom_point(aes(y = avg_eduy0, color = "平均受教育年限", shape = "平均受教育年限"), size = 4) +
labs(x = "年份", y = "平均受教育年限（年）", color = NULL, shape = NULL) +
scale_y_continuous(limits = c(8, NA)) +
scale_fill_identity() +  # 直接使用填充颜色
colors +
theme_minimal(base_size = 14) +
theme(
legend.title = element_text(size = 16),  # 图例标题字体大小
legend.text = element_text(size = 14)    # 图例文本字体大小
)
plot_name <- file.path(desdir, "2_Cog/worker/edu_year", "edu_year_全国.jpg")
ggsave(plot = p, filename = plot_name,
dpi = 300,
width = 16,
height = 9,
units = "in")
# 3.2 change of [by prov] ----
df_eduy_split <- split(df_eduy, df_eduy$prov_hanzi)
for (prov in names(df_eduy_split)) {
df_subset <- df_eduy_split[[prov]]
df_subset <- df_subset %>%
mutate(fill_color = ifelse(peduy0 > a_peduy0, "lightgray", "darkgray"))
p <- ggplot(df_subset, aes(x = cyear)) +
geom_ribbon(aes(ymin = pmin(peduy0, a_peduy0), ymax = pmax(peduy0, a_peduy0), fill = fill_color), alpha = 0.5) +
geom_line(aes(y = a_peduy0, color = "平均受教育年限调整值", group = 1), size = 1) +
geom_point(aes(y = a_peduy0, color = "平均受教育年限调整值", shape = "平均受教育年限调整值"), size = 4) +
geom_line(aes(y = peduy0, color = "平均受教育年限", group = 2), size = 1) +
geom_point(aes(y = peduy0, color = "平均受教育年限", shape = "平均受教育年限"), size = 4) +
labs(x = "年份", y = "平均受教育年限（年）", color = NULL, shape = NULL) +
scale_y_continuous(limits = c(5, NA)) +
scale_fill_identity() +  # 使用指定的填充颜色
colors +
theme_minimal(base_size = 14) +
theme(
legend.title = element_text(size = 16),  # 图例标题字体大小
legend.text = element_text(size = 14)    # 图例文本字体大小
)
plot_name <- file.path(desdir, "2_Cog/worker/edu_year", paste0("edu_year_", prov, ".jpg"))
ggsave(plot = p, filename = plot_name,
dpi = 300,
width = 16,
height = 9,
units = "in")
}
# 3 describe raw vals and adjusted vals of avg edu_year ----
# 3.1 change of [national] ----
file_name <- file.path(cog_dir, "8_Macro_Pop0_pCog0_aEduy0.dta")
df_eduy <- import(file_name)
df_eduy$cyear <- as.factor(df_eduy$cyear, levels = unique(df_eduy$cyear))
# 3 describe raw vals and adjusted vals of avg edu_year ----
# 3.1 change of [national] ----
file_name <- file.path(cog_dir, "8_Macro_Pop0_pCog0_aEduy0.dta")
df_eduy <- import(file_name)
df_eduy$cyear <- as.factor(df_eduy$cyear)
df_eduy <- df_eduy %>%
arrange(cyear)
df_sum <- df_eduy %>%
group_by(cyear) %>%
summarise(
t_pop0 = sum(pop0, na.rm = TRUE),
t_eduy0 = sum(eduy0, na.rm = TRUE),
t_a_eduy0 = sum(a_eduy0, na.rm = TRUE)
) %>%
mutate(
avg_eduy0 = t_eduy0 / t_pop0,
avg_a_eduy0 = t_a_eduy0 / t_pop0,
cyear = as.factor(cyear)
)
df_sum <- df_sum %>%
mutate(fill_color = ifelse(avg_a_eduy0 > avg_eduy0, "lightgray", "darkgray"))
p <- ggplot(df_sum, aes(x = cyear)) +
geom_ribbon(aes(ymin = pmin(avg_eduy0, avg_a_eduy0), ymax = pmax(avg_eduy0, avg_a_eduy0), fill = fill_color), alpha = 0.5) +
geom_line(aes(y = avg_a_eduy0, color = "平均受教育年限调整值", group = 1), size = 1) +
geom_point(aes(y = avg_a_eduy0, color = "平均受教育年限调整值", shape = "平均受教育年限调整值"), size = 4) +
geom_line(aes(y = avg_eduy0, color = "平均受教育年限", group = 2), size = 1) +
geom_point(aes(y = avg_eduy0, color = "平均受教育年限", shape = "平均受教育年限"), size = 4) +
labs(x = "年份", y = "平均受教育年限（年）", color = NULL, shape = NULL) +
scale_y_continuous(limits = c(8, NA)) +
scale_fill_identity() +  # 直接使用填充颜色
colors +
theme_minimal(base_size = 14) +
theme(
legend.title = element_text(size = 16),  # 图例标题字体大小
legend.text = element_text(size = 14)    # 图例文本字体大小
)
plot_name <- file.path(desdir, "2_Cog/worker/edu_year", "edu_year_全国.jpg")
ggsave(plot = p, filename = plot_name,
dpi = 300,
width = 16,
height = 9,
units = "in")
# 3.2 change of [by prov] ----
df_eduy_split <- split(df_eduy, df_eduy$prov_hanzi)
for (prov in names(df_eduy_split)) {
df_subset <- df_eduy_split[[prov]]
df_subset <- df_subset %>%
mutate(fill_color = ifelse(peduy0 > a_peduy0, "lightgray", "darkgray"))
p <- ggplot(df_subset, aes(x = cyear)) +
geom_ribbon(aes(ymin = pmin(peduy0, a_peduy0), ymax = pmax(peduy0, a_peduy0), fill = fill_color), alpha = 0.5) +
geom_line(aes(y = a_peduy0, color = "平均受教育年限调整值", group = 1), size = 1) +
geom_point(aes(y = a_peduy0, color = "平均受教育年限调整值", shape = "平均受教育年限调整值"), size = 4) +
geom_line(aes(y = peduy0, color = "平均受教育年限", group = 2), size = 1) +
geom_point(aes(y = peduy0, color = "平均受教育年限", shape = "平均受教育年限"), size = 4) +
labs(x = "年份", y = "平均受教育年限（年）", color = NULL, shape = NULL) +
scale_y_continuous(limits = c(5, NA)) +
scale_fill_identity() +  # 使用指定的填充颜色
colors +
theme_minimal(base_size = 14) +
theme(
legend.title = element_text(size = 16),  # 图例标题字体大小
legend.text = element_text(size = 14)    # 图例文本字体大小
)
plot_name <- file.path(desdir, "2_Cog/worker/edu_year", paste0("edu_year_", prov, ".jpg"))
ggsave(plot = p, filename = plot_name,
dpi = 300,
width = 16,
height = 9,
units = "in")
}
# 3 describe raw vals and adjusted vals of avg edu_year ----
# 3.1 change of [national] ----
file_name <- file.path(cog_dir, "8_Macro_Pop0_pCog0_aEduy0.dta")
df_eduy <- import(file_name)
df_eduy$cyear <- as.factor(df_eduy$cyear)
df_sum <- df_eduy %>%
group_by(cyear) %>%
summarise(
t_pop0 = sum(pop0, na.rm = TRUE),
t_eduy0 = sum(eduy0, na.rm = TRUE),
t_a_eduy0 = sum(a_eduy0, na.rm = TRUE)
) %>%
mutate(
avg_eduy0 = t_eduy0 / t_pop0,
avg_a_eduy0 = t_a_eduy0 / t_pop0,
fill_color = ifelse(avg_a_eduy0 > avg_eduy0, "lightgray", "darkgray")
)
p <- ggplot(df_sum, aes(x = cyear)) +
geom_ribbon(aes(ymin = pmin(avg_eduy0, avg_a_eduy0), ymax = pmax(avg_eduy0, avg_a_eduy0), fill = fill_color), alpha = 0.5) +
geom_line(aes(y = avg_a_eduy0, color = "平均受教育年限调整值", group = 1), size = 1) +
geom_point(aes(y = avg_a_eduy0, color = "平均受教育年限调整值", shape = "平均受教育年限调整值"), size = 4) +
geom_line(aes(y = avg_eduy0, color = "平均受教育年限", group = 2), size = 1) +
geom_point(aes(y = avg_eduy0, color = "平均受教育年限", shape = "平均受教育年限"), size = 4) +
labs(x = "年份", y = "平均受教育年限（年）", color = NULL, shape = NULL) +
scale_y_continuous(limits = c(8, NA)) +
scale_fill_identity() +  # 直接使用填充颜色
colors +
theme_minimal(base_size = 14) +
theme(
legend.title = element_text(size = 16),  # 图例标题字体大小
legend.text = element_text(size = 14)    # 图例文本字体大小
)
plot_name <- file.path(desdir, "2_Cog/worker/edu_year", "edu_year_全国.jpg")
ggsave(plot = p, filename = plot_name,
dpi = 300,
width = 16,
height = 9,
units = "in")
# 3.2 change of [by prov] ----
df_eduy_split <- split(df_eduy, df_eduy$prov_hanzi)
for (prov in names(df_eduy_split)) {
df_subset <- df_eduy_split[[prov]]
df_subset <- df_subset %>%
mutate(fill_color = ifelse(peduy0 > a_peduy0, "lightgray", "darkgray"))
p <- ggplot(df_subset, aes(x = cyear)) +
geom_ribbon(aes(ymin = pmin(peduy0, a_peduy0), ymax = pmax(peduy0, a_peduy0), fill = fill_color), alpha = 0.5) +
geom_line(aes(y = a_peduy0, color = "平均受教育年限调整值", group = 1), size = 1) +
geom_point(aes(y = a_peduy0, color = "平均受教育年限调整值", shape = "平均受教育年限调整值"), size = 4) +
geom_line(aes(y = peduy0, color = "平均受教育年限", group = 2), size = 1) +
geom_point(aes(y = peduy0, color = "平均受教育年限", shape = "平均受教育年限"), size = 4) +
labs(x = "年份", y = "平均受教育年限（年）", color = NULL, shape = NULL) +
scale_y_continuous(limits = c(5, NA)) +
scale_fill_identity() +  # 使用指定的填充颜色
colors +
theme_minimal(base_size = 14) +
theme(
legend.title = element_text(size = 16),  # 图例标题字体大小
legend.text = element_text(size = 14)    # 图例文本字体大小
)
plot_name <- file.path(desdir, "2_Cog/worker/edu_year", paste0("edu_year_", prov, ".jpg"))
ggsave(plot = p, filename = plot_name,
dpi = 300,
width = 16,
height = 9,
units = "in")
}
# 3.2 change of [by prov] ----
df_eduy_split <- split(df_eduy, df_eduy$prov_hanzi)
for (prov in names(df_eduy_split)) {
df_subset <- df_eduy_split[[prov]]
df_subset$cyear <- as.numeric(df_subset$cyear)
df_subset <- df_subset %>%
mutate(fill_color = ifelse(peduy0 > a_peduy0, "lightgray", "darkgray"))
p <- ggplot(df_subset, aes(x = cyear)) +
geom_ribbon(aes(ymin = pmin(peduy0, a_peduy0), ymax = pmax(peduy0, a_peduy0), fill = fill_color), alpha = 0.5) +
geom_line(aes(y = a_peduy0, color = "平均受教育年限调整值", group = 1), size = 1) +
geom_point(aes(y = a_peduy0, color = "平均受教育年限调整值", shape = "平均受教育年限调整值"), size = 4) +
geom_line(aes(y = peduy0, color = "平均受教育年限", group = 2), size = 1) +
geom_point(aes(y = peduy0, color = "平均受教育年限", shape = "平均受教育年限"), size = 4) +
labs(x = "年份", y = "平均受教育年限（年）", color = NULL, shape = NULL) +
scale_y_continuous(limits = c(5, NA)) +
scale_x_continuous(breaks = unique(df_sum$cyear)) +  # 确保显示为整数
scale_fill_identity() +  # 使用指定的填充颜色
colors +
theme_minimal(base_size = 14) +
theme(
legend.title = element_text(size = 16),  # 图例标题字体大小
legend.text = element_text(size = 14)    # 图例文本字体大小
)
plot_name <- file.path(desdir, "2_Cog/worker/edu_year", paste0("edu_year_", prov, ".jpg"))
ggsave(plot = p, filename = plot_name,
dpi = 300,
width = 16,
height = 9,
units = "in")
}
# 3.2 change of [by prov] ----
df_eduy_split <- split(df_eduy, df_eduy$prov_hanzi)
for (prov in names(df_eduy_split)) {
df_subset <- df_eduy_split[[prov]]
df_subset$cyear <- as.numeric(df_subset$cyear)
df_subset <- df_subset %>%
mutate(fill_color = ifelse(peduy0 > a_peduy0, "lightgray", "darkgray"))
p <- ggplot(df_subset, aes(x = cyear)) +
geom_ribbon(aes(ymin = pmin(peduy0, a_peduy0), ymax = pmax(peduy0, a_peduy0), fill = fill_color), alpha = 0.5) +
geom_line(aes(y = a_peduy0, color = "平均受教育年限调整值", group = 1), size = 1) +
geom_point(aes(y = a_peduy0, color = "平均受教育年限调整值", shape = "平均受教育年限调整值"), size = 4) +
geom_line(aes(y = peduy0, color = "平均受教育年限", group = 2), size = 1) +
geom_point(aes(y = peduy0, color = "平均受教育年限", shape = "平均受教育年限"), size = 4) +
labs(x = "年份", y = "平均受教育年限（年）", color = NULL, shape = NULL) +
scale_y_continuous(limits = c(5, NA)) +
scale_x_continuous(breaks = unique(df_subset$cyear)) +  # 确保显示为整数
scale_fill_identity() +  # 使用指定的填充颜色
colors +
theme_minimal(base_size = 14) +
theme(
legend.title = element_text(size = 16),  # 图例标题字体大小
legend.text = element_text(size = 14)    # 图例文本字体大小
)
plot_name <- file.path(desdir, "2_Cog/worker/edu_year", paste0("edu_year_", prov, ".jpg"))
ggsave(plot = p, filename = plot_name,
dpi = 300,
width = 16,
height = 9,
units = "in")
}
# 3 describe raw vals and adjusted vals of avg edu_year ----
# 3.1 change of [national] ----
file_name <- file.path(cog_dir, "8_Macro_Pop0_pCog0_aEduy0.dta")
df_eduy <- import(file_name)
df_sum <- df_eduy %>%
group_by(cyear) %>%
summarise(
t_pop0 = sum(pop0, na.rm = TRUE),
t_eduy0 = sum(eduy0, na.rm = TRUE),
t_a_eduy0 = sum(a_eduy0, na.rm = TRUE)
) %>%
mutate(
avg_eduy0 = t_eduy0 / t_pop0,
avg_a_eduy0 = t_a_eduy0 / t_pop0,
fill_color = ifelse(avg_a_eduy0 > avg_eduy0, "lightgray", "darkgray")
)
p <- ggplot(df_sum, aes(x = cyear)) +
geom_ribbon(aes(ymin = pmin(avg_eduy0, avg_a_eduy0), ymax = pmax(avg_eduy0, avg_a_eduy0), fill = fill_color), alpha = 0.5) +
geom_line(aes(y = avg_a_eduy0, color = "平均受教育年限调整值", group = 1), size = 1) +
geom_point(aes(y = avg_a_eduy0, color = "平均受教育年限调整值", shape = "平均受教育年限调整值"), size = 4) +
geom_line(aes(y = avg_eduy0, color = "平均受教育年限", group = 2), size = 1) +
geom_point(aes(y = avg_eduy0, color = "平均受教育年限", shape = "平均受教育年限"), size = 4) +
labs(x = "年份", y = "平均受教育年限（年）", color = NULL, shape = NULL) +
scale_y_continuous(limits = c(8, NA)) +
scale_fill_identity() +  # 直接使用填充颜色
colors +
theme_minimal(base_size = 14) +
theme(
legend.title = element_text(size = 16),  # 图例标题字体大小
legend.text = element_text(size = 14)    # 图例文本字体大小
)
plot_name <- file.path(desdir, "2_Cog/worker/edu_year", "edu_year_全国.jpg")
ggsave(plot = p, filename = plot_name,
dpi = 300,
width = 16,
height = 9,
units = "in")
# 3.2 change of [by prov] ----
df_eduy_split <- split(df_eduy, df_eduy$prov_hanzi)
for (prov in names(df_eduy_split)) {
df_subset <- df_eduy_split[[prov]]
df_subset <- df_subset %>%
mutate(fill_color = ifelse(peduy0 > a_peduy0, "lightgray", "darkgray"))
p <- ggplot(df_subset, aes(x = cyear)) +
geom_ribbon(aes(ymin = pmin(peduy0, a_peduy0), ymax = pmax(peduy0, a_peduy0), fill = fill_color), alpha = 0.5) +
geom_line(aes(y = a_peduy0, color = "平均受教育年限调整值", group = 1), size = 1) +
geom_point(aes(y = a_peduy0, color = "平均受教育年限调整值", shape = "平均受教育年限调整值"), size = 4) +
geom_line(aes(y = peduy0, color = "平均受教育年限", group = 2), size = 1) +
geom_point(aes(y = peduy0, color = "平均受教育年限", shape = "平均受教育年限"), size = 4) +
labs(x = "年份", y = "平均受教育年限（年）", color = NULL, shape = NULL) +
scale_y_continuous(limits = c(5, NA)) +
scale_x_continuous(breaks = unique(df_subset$cyear)) +  # 确保显示为整数
scale_fill_identity() +  # 使用指定的填充颜色
colors +
theme_minimal(base_size = 14) +
theme(
legend.title = element_text(size = 16),  # 图例标题字体大小
legend.text = element_text(size = 14)    # 图例文本字体大小
)
plot_name <- file.path(desdir, "2_Cog/worker/edu_year", paste0("edu_year_", prov, ".jpg"))
ggsave(plot = p, filename = plot_name,
dpi = 300,
width = 16,
height = 9,
units = "in")
}
# 3 describe raw vals and adjusted vals of avg edu_year ----
# 3.1 change of [national] ----
file_name <- file.path(cog_dir, "8_Macro_Pop0_pCog0_aEduy0.dta")
df_eduy <- import(file_name)
df_sum <- df_eduy %>%
group_by(cyear) %>%
summarise(
t_pop0 = sum(pop0, na.rm = TRUE),
t_eduy0 = sum(eduy0, na.rm = TRUE),
t_a_eduy0 = sum(a_eduy0, na.rm = TRUE)
) %>%
mutate(
avg_eduy0 = t_eduy0 / t_pop0,
avg_a_eduy0 = t_a_eduy0 / t_pop0,
fill_color = ifelse(avg_a_eduy0 > avg_eduy0, "lightgray", "darkgray")
)
p <- ggplot(df_sum, aes(x = cyear)) +
geom_ribbon(aes(ymin = pmin(avg_eduy0, avg_a_eduy0), ymax = pmax(avg_eduy0, avg_a_eduy0), fill = fill_color), alpha = 0.5) +
geom_line(aes(y = avg_a_eduy0, color = "平均受教育年限调整值", group = 1), size = 1) +
geom_point(aes(y = avg_a_eduy0, color = "平均受教育年限调整值", shape = "平均受教育年限调整值"), size = 4) +
geom_line(aes(y = avg_eduy0, color = "平均受教育年限", group = 2), size = 1) +
geom_point(aes(y = avg_eduy0, color = "平均受教育年限", shape = "平均受教育年限"), size = 4) +
labs(x = "年份", y = "平均受教育年限（年）", color = NULL, shape = NULL) +
scale_y_continuous(limits = c(8, NA)) +
scale_fill_identity() +  # 直接使用填充颜色
colors +
theme_minimal(base_size = 14) +
theme(
legend.title = element_text(size = 16),  # 图例标题字体大小
legend.text = element_text(size = 14)    # 图例文本字体大小
) +
ggtitle("全国")
plot_name <- file.path(desdir, "2_Cog/worker/edu_year", "edu_year_全国.jpg")
ggsave(plot = p, filename = plot_name,
dpi = 300,
width = 16,
height = 9,
units = "in")
# 3.2 change of [by prov] ----
df_eduy_split <- split(df_eduy, df_eduy$prov_hanzi)
for (prov in names(df_eduy_split)) {
df_subset <- df_eduy_split[[prov]]
df_subset <- df_subset %>%
mutate(fill_color = ifelse(peduy0 > a_peduy0, "lightgray", "darkgray"))
p <- ggplot(df_subset, aes(x = cyear)) +
geom_ribbon(aes(ymin = pmin(peduy0, a_peduy0), ymax = pmax(peduy0, a_peduy0), fill = fill_color), alpha = 0.5) +
geom_line(aes(y = a_peduy0, color = "平均受教育年限调整值", group = 1), size = 1) +
geom_point(aes(y = a_peduy0, color = "平均受教育年限调整值", shape = "平均受教育年限调整值"), size = 4) +
geom_line(aes(y = peduy0, color = "平均受教育年限", group = 2), size = 1) +
geom_point(aes(y = peduy0, color = "平均受教育年限", shape = "平均受教育年限"), size = 4) +
labs(x = "年份", y = "平均受教育年限（年）", color = NULL, shape = NULL) +
scale_y_continuous(limits = c(5, NA)) +
scale_x_continuous(breaks = unique(df_subset$cyear)) +  # 确保显示为整数
scale_fill_identity() +  # 使用指定的填充颜色
colors +
theme_minimal(base_size = 14) +
theme(
legend.title = element_text(size = 16),  # 图例标题字体大小
legend.text = element_text(size = 14)    # 图例文本字体大小
) +
ggtitle(as.character(df_subset$prov_hanzi))
plot_name <- file.path(desdir, "2_Cog/worker/edu_year", paste0("edu_year_", prov, ".jpg"))
ggsave(plot = p, filename = plot_name,
dpi = 300,
width = 16,
height = 9,
units = "in")
}
file_name <- file.path(cog_dir, "8_Macro_Pop0_pCog0_aEduy0.dta")
df_eduy <- import(file_name)
df_sum <- df_eduy %>%
group_by(cyear) %>%
summarise(
t_pop0 = sum(pop0, na.rm = TRUE),
t_eduy0 = sum(eduy0, na.rm = TRUE),
t_a_eduy0 = sum(a_eduy0, na.rm = TRUE)
) %>%
mutate(
avg_eduy0 = t_eduy0 / t_pop0,
avg_a_eduy0 = t_a_eduy0 / t_pop0,
fill_color = ifelse(avg_a_eduy0 > avg_eduy0, "lightgray", "darkgray")
)
p <- ggplot(df_sum, aes(x = cyear)) +
geom_ribbon(aes(ymin = pmin(avg_eduy0, avg_a_eduy0), ymax = pmax(avg_eduy0, avg_a_eduy0), fill = fill_color), alpha = 0.5) +
geom_line(aes(y = avg_a_eduy0, color = "平均受教育年限调整值", group = 1), size = 1) +
geom_point(aes(y = avg_a_eduy0, color = "平均受教育年限调整值", shape = "平均受教育年限调整值"), size = 4) +
geom_line(aes(y = avg_eduy0, color = "平均受教育年限", group = 2), size = 1) +
geom_point(aes(y = avg_eduy0, color = "平均受教育年限", shape = "平均受教育年限"), size = 4) +
labs(x = "年份", y = "平均受教育年限（年）", color = NULL, shape = NULL) +
scale_y_continuous(limits = c(8, NA)) +
scale_x_continuous(breaks = unique(df_sum$cyear)) +  # 确保显示为整数
scale_fill_identity() +  # 直接使用填充颜色
colors +
theme_minimal(base_size = 14) +
theme(
legend.title = element_text(size = 16),  # 图例标题字体大小
legend.text = element_text(size = 14)    # 图例文本字体大小
) +
ggtitle("全国")
plot_name <- file.path(desdir, "2_Cog/worker/edu_year", "edu_year_全国.jpg")
ggsave(plot = p, filename = plot_name,
dpi = 300,
width = 16,
height = 9,
units = "in")
df_sum <- df_eduy %>%
group_by(cyear) %>%
summarise(
t_pop0 = sum(pop0, na.rm = TRUE),
t_eduy0 = sum(eduy0, na.rm = TRUE),
t_a_eduy0 = sum(a_eduy0, na.rm = TRUE)
) %>%
mutate(
avg_eduy0 = t_eduy0 / t_pop0,
avg_a_eduy0 = t_a_eduy0 / t_pop0,
fill_color = ifelse(avg_a_eduy0 > avg_eduy0, "lightgray", "darkgray")
)
p <- ggplot(df_sum, aes(x = cyear)) +
geom_ribbon(aes(ymin = pmin(avg_eduy0, avg_a_eduy0), ymax = pmax(avg_eduy0, avg_a_eduy0), fill = fill_color), alpha = 0.5) +
geom_line(aes(y = avg_a_eduy0, color = "平均受教育年限调整值", group = 1), size = 1) +
geom_point(aes(y = avg_a_eduy0, color = "平均受教育年限调整值", shape = "平均受教育年限调整值"), size = 4) +
geom_line(aes(y = avg_eduy0, color = "平均受教育年限", group = 2), size = 1) +
geom_point(aes(y = avg_eduy0, color = "平均受教育年限", shape = "平均受教育年限"), size = 4) +
labs(x = "年份", y = "平均受教育年限（年）", color = NULL, shape = NULL) +
scale_y_continuous(limits = c(5, NA)) +
scale_x_continuous(breaks = unique(df_sum$cyear)) +  # 确保显示为整数
scale_fill_identity() +  # 直接使用填充颜色
colors +
theme_minimal(base_size = 14) +
theme(
legend.title = element_text(size = 16),  # 图例标题字体大小
legend.text = element_text(size = 14)    # 图例文本字体大小
) +
ggtitle("全国")
plot_name <- file.path(desdir, "2_Cog/worker/edu_year", "edu_year_全国.jpg")
ggsave(plot = p, filename = plot_name,
dpi = 300,
width = 16,
height = 9,
units = "in")
# 0. Info ----
# Project: Human capital
# Author: LiuZiyu
# Created date: 2024/10
# Last edited date: 2024/10/29
# This script is for:
#   1) describing gdp and human capital,
#   2) describing adjusting beta,
#   3) describing avg edu_year and avg adj_edu_year.
source("D:/# Library/1 Seminar/1_Publishs/1031-认知技能/data/Rscript/config.R")
lihk_dir <- file.path(mydir, "3_LIHK")
# 1 describe micro income ----
df_inc <- import(file.path(lihk_dir, "tmp_inc.dta"))
View(df_inc)
# 0. Info ----
# Project: Human capital
# Author: LiuZiyu
# Created date: 2024/10
# Last edited date: 2024/10/29
# This script is for:
#   1) describing gdp and human capital,
#   2) describing adjusting beta,
#   3) describing avg edu_year and avg adj_edu_year.
source("D:/# Library/1 Seminar/1_Publishs/1031-认知技能/data/Rscript/config.R")
lihk_dir <- file.path(mydir, "3_LIHK")
# 1 describe micro income ----
df_inc <- import(file.path(lihk_dir, "tmp_inc.dta"))
skim(df_inc)
View(df_inc)
skim(df_inc)
dfSummary(df_inc) %>% stview()
setwd(file.path(desdir, "3_LIHK"))
dfSummary(df_inc) %>% stview()
